define(["jquery","eventDispatcher","breakpoints","viewport"],function(e,t,n,r){function s(t){if(a(null),!t.parent().hasClass(d)){var r=e("header.hero"),s=e(".search-header-module"),o=e("#page"),i=r.height(),l=s.height(),c=i||l,u=e(window).scrollTop();t.parent().addClass(d),n.is("standard")||(o.addClass(f),c>u?(e("html, body").animate({scrollTop:c+1},300),o.css("top",-(u+c+1)+"px"),v=c+1):(o.css("top",-u+"px"),v=u)),setTimeout(function(){e("body").on("click",a)},0)}}function a(t){(null===t||!e(t.target).hasClass("js-filter-expander")&&!e(t.target).hasClass("filter-menu")&&!e(t.target).parents(".filter-menu").length||e(t.target).hasClass("js-filter-expander")&&e(t.target).parent().hasClass(d))&&(e(".js-filter-expander").parent().removeClass(d),e("body").off("click",a),e("#page").removeClass(f).removeAttr("style"),null!==v&&(e("html, body").scrollTop(v),v=null))}function o(){var e,t,n=document.querySelector("#header-main"),r=n.classList.contains(p);return n.classList.add(h),n.classList.add(p),e=n.getBoundingClientRect(),t=e.height+e.top,r||n.classList.remove(p),n.classList.remove(h),t}function i(){var e=document.querySelector(".filter-bar-container"),t=document.querySelector("#header-main"),n=document.querySelector(".filter-bar-container-placeholder"),r=t.offsetHeight,s=o(),a=function(n){t.classList.contains(p)||e.classList[n[0].target.getBoundingClientRect().top>=r?"remove":"add"](u)},i=function(n){t.classList.contains(p)&&e.classList[n[0].target.getBoundingClientRect().top>=r?"remove":"add"](u)};null!==x&&x.forEach(function(e){e.disconnect()}),x=[],x[0]=new IntersectionObserver(a,{root:null,rootMargin:-r+"px 0px 0px 0px",threshold:0}),x[1]=new IntersectionObserver(i,{root:null,rootMargin:-s+"px 0px 0px 0px",threshold:0}),x.forEach(function(e){e.observe(n)})}function l(){if(e(".filter-category-level").length){var t="";n.is("standard")||(t=m.height()),e(".content").css("margin-top",t)}}function c(){l(),n.change(l),e(".js-filter-expander").on("mouseenter",function(t){n.is("standard")&&s(e(this))}).on("click",function(t){e(this).parent().hasClass(d)?a(t):s(e(this))}).parent().on("mouseleave",function(e){n.is("standard")&&a(null)}),g===!1&&(i(),r.resize(i)),b&&y&&C.observe(b)}var d="_active",u="filter-bar-sticky",f="only-scroll-nav-drawer",p="_compressed",h="_force_notransitions",g=!!e('[data-module="productCapsuleGrid"]').length,m=e(".filter-bar"),v=null,x=null,y=document.querySelector(".filter-tray"),b=document.querySelector("#productgrid-filter-bar"),C=new ResizeObserver(function(e){e.forEach(function(e){y.style.maxHeight="calc(100svh - 72px - "+e.target.offsetHeight+"px - "+(n.is("standard")?194:181)+"px)"})});return{load:function(){function e(){}c(),t.dispatchAndListen("filterBar",e)}}});