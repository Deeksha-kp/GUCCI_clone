define(["jquery","eventDispatcher","ajaxConfig","productGrid","loader","imageLoader","productGridBackground","genericUtilities","video","breakpoints","os"],function(t,e,o,i,r,n,a,d,s,l,c){function u(t){var e={};return JSON.parse(t).forEach(function(t){e[t.pageNumber]={buttonTitle:t.buttonTitle,buttonType:t.buttonType}}),e}function p(){E=t("."+Q);var e=history.state,o=window.location.pathname+window.location.search;if(k(t(".product-tiles-grid > .product-tiles-grid-item:not(.product-tiles-grid-promo-component)"),o),t(".product-tiles-grid").on("click",".product-tiles-grid-item",function(){var e=t(this).attr(A);history.replaceState({firstVisibleProductCode:t(".product-tiles-grid-item-link",this).attr(U)},"",e)}).on("click",".quick-pdp .view-all-details",function(){history.replaceState({firstVisibleProductCode:t(".quick-pdp .gucciProductCode").val()},"",window.location.pathname+window.location.search)}).on("click","."+Q,function(){history.replaceState({firstVisibleProductCode:Q},"",window.location.pathname+window.location.search)}),0===H)et=!0,_(),v(0);else{if(S()||(ot=!0),t("header.hero").hide(),E.hide(),null===e||null===e.firstVisibleProductCode){var i=t(".product-tiles-grid > .product-tiles-grid-item:not(.product-tiles-grid-promo-component):first").offset().top-t("#header-main").height()-parseInt(t(".content").css("margin-top"),10);t(window).scrollTop()<i&&x(H,!1)}setTimeout(function(){g(H)},0)}m(),l.change(function(){T(),m()}),t(document).on("quickpdp.shown",m).on("quickpdp.removed",m)}function h(e){return function(o){var i,r,n=t(e),a=window.location.pathname+window.location.search,d=n.hasClass("product-tiles-grid-item");if(o[0].isIntersecting){if(i=d?n.attr(A):a,a===i)return;r=d?t(".product-tiles-grid-item-link",e).attr(U):n.hasClass("quick-pdp")?t(".gucciProductCode",n).val():n.data("componentuid"),history.state&&history.state.firstVisibleProductCode===r||it.add(i,null)}}}function m(){Z.length>0&&(Z.forEach(function(t){t.disconnect()}),Z=[]);var t=document.querySelectorAll(".product-tiles-grid .product-tiles-grid-item:not(.product-tiles-grid-promo-component), .product-tiles-grid .quick-pdp, #page [data-componentuid]"),e=-window.innerHeight+document.querySelector("header#header-main").offsetHeight;t.forEach(function(t){var o=new IntersectionObserver(h(t),{root:null,rootMargin:"0px 0px "+e+"px 0px",threshold:0});o.observe(t),Z.push(o)})}function g(t){var e=document.querySelector(".product-tiles-grid"),o=function(o){o[0].isIntersecting===!1&&(x(t,!1),Y.unobserve(e))};null!==Y&&Y.disconnect(),Y=new IntersectionObserver(o,{root:null,rootMargin:"10% 0px -100% 0px",threshold:0}),Y.observe(e)}function f(t){var e=document.querySelector(".product-tiles-grid"),o=function(o){o[0].isIntersecting===!1&&(x(t,!0),X.unobserve(e))};null!==X&&X.disconnect(),X=new IntersectionObserver(o,{root:null,rootMargin:"-100% 0px 10% 0px",threshold:0}),X.observe(e)}function w(t){return G[t]?G[t].buttonType:0}function v(t){0===w(t)?f(t):(y(function(){x(t,!0)}),V.text(G[t].buttonTitle))}function y(t){V.removeClass("_hidden").on("click",function(e){P(e),t(),V.addClass("_hidden").off("click")})}function b(t){var e=window.location.pathname,o=e.split("/");return isNaN(parseInt(o[o.length-1],10))?o.push(t):0===t?o.pop():o[o.length-1]=t,o.join("/")+window.location.search}function k(e,o){return e.filter(".product-tiles-grid-item").each(function(){t(this).attr(A,o)}),e}function C(t){var e=t*R;return e+R>D?D-e:R}function I(e,o,i){i=!!i;for(var r="",n=0;o>n;n++)r+='<article class="product-tiles-grid-item product-tiles-grid-item-medium product-tiles-grid-item-small _loading" data-paginated-url="'+e+'"></article>';i?t(".product-tiles-grid-load-top-content").after(r):t(".product-tiles-grid-load-content").before(r)}function x(e,o){o="undefined"==typeof o?!0:o;var d=t("."+(o?"product-tiles-grid-load-content":"product-tiles-grid-load-top-content")),l=J+" "+F,c=window.location.search.replace("?",""),u=o?e+1:e-1,p=b(u);""!==c&&(c+="&"),c+="categoryCode="+B+"&show=Page&page="+u,c=c.replace(/[:(.?)]+:/g,":"),r.updateElementClass(d,z,l),o?E.length&&1===u&&(E.insertBefore(d).show(),d.siblings("."+Q).find(W).slick("setPosition")):E.length&&0===u&&(E.insertAfter(d).show(),d.siblings("."+Q).find(W).slick("setPosition")),I(p,C(u),!o),a.loadMoreBackgrounds(o,u),o||0===u&&t("header.hero").show(),$.includes(u)||($.push(u),t.ajax({url:tt["PRODUCT-TILES-GRID"],dataType:"json",data:c}).done(function(e){t("[data-placeholder-cell]").remove(),t(window).trigger("ajax-page-loaded"),t(".new-4-cols-layout").data("has-backgrounds")&&(e.products.items=a.mapToTransparentImages(e));var l=0===u?0:R*u+O,c=0===u?N:[],h=i.compiler(e,"product-tiles-grid",j,u,l,c),w=k(t(h.html),p);if(r.loadResponse(t('.product-tiles-grid-item[data-paginated-url="'+p+'"]'),w,a.addBorderRight),0===u){var y=t(".product-tiles-grid-promo-component");y.each(function(e,o){var i=t(o),r=i.data("location")-e,n=t(t(".product-tiles-grid-item").get(r-1));i.insertBefore(n),setTimeout(function(){i.find(W).slick("refresh")},0)}),t(".new-4-cols-layout").addClass("page-zero-loaded"),s.load()}else t(".new-4-cols-layout").addClass("page-n-loaded");n.loadImage(d),t("body").removeClass(K),et&&o&&M>u+1&&setTimeout(function(){v(u)},0),!o&&u>0&&setTimeout(function(){g(u)},0),o||0!==u||t("header.hero").show(),a.displayBlankCells(),t(".new-4-cols-layout").data("has-backgrounds")&&a.adjustPosition(),m(),0===u&&(et=!0,_(),f(H))}).fail(function(){r.updateElementClass(d,F,z),d.empty()}))}function P(t){t&&t.preventDefault&&t.preventDefault()}function T(){var e=t(".promo-component-overlay"),o=t(".product-tiles-grid-promo-component .promo-product-description"),i=e.data("promo-max-chars-standard");l.is("medium")&&(i=e.data("promo-max-chars-medium")),l.is("small")&&(i=e.data("promo-max-chars-small")),o.each(function(){var e=t(this).data("promo-product-description")||"";t(this).text(e),e.length>i&&t(this).text(e.substr(0,i-1)+"â€¦")})}function S(){return history.state&&history.state.firstVisibleProductCode}function q(){document.getElementById("plp_loader").classList.add("_hidden"),document.getElementById("plp_search_result").classList.remove("_hidden")}function _(){if(q(),ot){const t=document.querySelector('.product-tiles-grid > .product-tiles-grid-item[data-paginated-url="'+b(H)+'"]');if(!t)return;t.scrollIntoView({block:"center"})}else if(S()){const e=document.getElementById(history.state.firstVisibleProductCode);if(!e)return;e.scrollIntoView({block:"center"}),history.replaceState(null,"",window.location.pathname+window.location.search)}}var E,L=t('[data-module="ajaxPagination"]'),V=t("#productGridLoadMoreLnk"),j=L.attr("data-component-name"),B=L.attr("data-category-code"),G=u(L.attr("data-cta-details")),H=parseInt(L.attr("data-start-page"),10),R=parseInt(L.attr("data-items-per-page"),10),D=parseInt(L.attr("data-total-items"),10),M=parseInt(L.attr("data-total-pages"),10),O=parseInt(L.attr("data-number-of-promos"),10),N=L.data("promos-positions"),A="data-paginated-url",U="data-style-id",z="_loading",J="_loaded",F="_error",K="overlay-lock",Q="grid-shoppable-stories",W=".carousel-inner",X=(!!t("[data-module=productCapsuleGrid]").length,null),Y=null,Z=[],$=[H],tt=o.config,et=!1,ot=!1,it=function(){function t(t,r){e=r,i=t,null===o&&(o=window.setTimeout(function(){history.replaceState({firstVisibleProductCode:e},"",i),e=null,o=null,i=null},100))}var e=null,o=null,i=null;return{add:t}}();return{load:function(){function o(){}!c.isSafari()&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const i=0===t("header.hero").length;window.heroLoaded||i?(d.registerGridHandlebarsHelper(),p(),T()):window.addEventListener("heroLoaded",function(){d.registerGridHandlebarsHelper(),p(),T()}),e.dispatchAndListen("ajaxPagination",o)}}});