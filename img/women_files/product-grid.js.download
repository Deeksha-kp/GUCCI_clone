define(["jquery","eventDispatcher","handlebars","savedItems","productGridBackground","trackViewItemList"],function(e,t,i,a,r,d){function n(t,r,n,s,m,u){var c=t.products,l=e(".content.search-result").attr("data-component-name"),p=1,f="",g=e("#"+r).html(),h=i.compile(g),I="undefined"!=typeof c.maxStandard?c.maxStandard:c.items.length,R="undefined"!=typeof c.maxMedium?c.maxMedium:c.items.length,M="undefined"!=typeof c.maxSmall?c.maxSmall:c.items.length;I=null===I?c.items.length:I;var y=[];for(var D in c.items){var E={},v=c.items[D],L=o.GRID;"undefined"!=typeof c.items[D].isFeatured&&(L+=" "+o.GRID+o.FEATURED+c.items[D].isFeatured),L+=R>=p?" "+o.GRID+o.MEDIUM:" "+o.GRID+o.MEDIUM+o.REMOVE,L+=M>=p?" "+o.GRID+o.SMALL:" "+o.GRID+o.SMALL+o.REMOVE,c.items[D].productClass=L;var k=parseInt(D,10)+m+1;if(u.indexOf(k)>-1&&k++,c.items[D].productLink=c.items[D].productLink,c.items[D].position=k,c.items[D].listName=l,c.items[D].categoryPath=v.categoryPath,!(I>=p))break;f+=h(c.items[D]),p++,E.name=v.title,E.id=v.productCode,E.price=v.rawPrice,E.dimension5=v.saleType,E.category=t.bcCategoryPath,E.variant=v.variant,E.list=n,E.position=k,y.push(E)}return d.trackViewItemList(y,s,dataLayer),a.fillSavedItems(),{html:f}}function s(){r.adjustBackgroundRowsVisibility(),r.adjustPosition(),r.displayBlankCells(),r.addBorderRight(),e(window).off("resize.gridbackground").on("resize.gridbackground",function(e){r.adjustPosition(),r.addBorderRight()})}var o={GRID:"product-tiles-grid-item",MEDIUM:"-medium",SMALL:"-small",REMOVE:"-remove",FEATURED:"-featured"};return t.dispatchAndListen("productGrid",s),{compiler:n}});