define(["jquery","eventDispatcher","handlebars","ajaxLoader","breakpoints","imageLoader","savedItems","urlPathControl","productGridBackground","vanillaLazyload"],function(e,t,a,r,l,n,o,s,d,c){function u(e){G?w(e):f(e.delegateTarget.id)}function p(t){var a,i=GUCCI[L+t];return s.urlSetup(M,"products",t),e("#products-list-"+t+" article",z).remove(),a="all"!==M?e.map(i.items,function(e){var t,a=e.type.split(",");if(a.length>0)for(var i=0;i<a.length;i++)a[i]===M&&(t=e);else e.type===M&&(t=e);return t}):i.items}function m(){var t=l.is("standard")?5:l.is("medium")?3:2;e(".product-tiles-grid",z).each(function(){e("article",e(this)).addClass("border-right").removeClass("no-border-right").not("._hide").filter(function(e){return(e+1)%t===0}).toggleClass("border-right no-border-right")})}function f(t){var a,i,r,o=GUCCI[L+t];a=l.is("small")?o.maxSmall:l.is("medium")?o.maxMedium:o.maxStandard,r=e("#"+t).data("hasBackgrounds")?d.mapToTransparentImages(p(t)):p(t);for(var s=0;a>s&&s<r.length;s++)i=r[s],e("#products-list-"+t,z).append(h(i));C(t),m(),n.loadImage(z),T=r.length,d.displayBlankCells(t),d.adjustPosition(),setTimeout(g(t)),x()}function g(t){var a=GUCCI[L+t],i=l.is("small")&&T<=a.maxSmall,r=l.is("medium")&&T<=a.maxMedium,n=(l.is("standard")||l.is("large"))&&T<=a.maxStandard;i||r||n?(e("#"+t+" "+I).fadeOut(S),e("#"+t+" "+I).parent().hide()):(e("#"+t+" "+I).fadeIn(S),e("#"+t+" "+I).parent().show())}function h(t){var i=e("script#capsule-products-detail").html(),r=a.compile(i),l=r(t);return l}function v(){M=e(this).attr("data-filter")}function k(){var t=this.lastChild,a=t.innerText;for(i=0;i<e(".capsule-filters-item-link").length;i++)a.toUpperCase()==e(".capsule-filters-item-link")[i].innerText&&e(".capsule-filters-item-link")[i].click();e("html,body").animate({scrollTop:e(".capsule-products-grid-title").offset().top},"slow")}function w(t){t.preventDefault();var a,i=t.delegateTarget.id,r=B.scrollTop();a=p(i),e.each(a,function(t,a){e("#products-list-"+i,z).append(h(a))}),C(i),e("#"+i+" "+I).fadeOut(S),e("#"+i+" "+I).parent().hide(),G=!0,z.addClass(P),o.fillSavedItems(),n.loadImage(z),e('[data-has-backgrounds="true"]').length&&(d.displayBlankCells(i),d.adjustPosition()),B.scrollTop(r),x()}function C(t){var a=e(".product-tiles-grid-item","#"+t).length,i=[{name:"small",rows:Math.ceil(a/2)},{name:"medium",rows:Math.ceil(a/3)},{name:"large",rows:Math.ceil(a/5)}];e.each(i,function(a,i){e(".product-grid-row-background-wrapper--"+i.name+" img","#"+t).each(function(t,a){e(a).css("display",t<i.rows?"block":"none")})})}function b(){for(var t=e(y),a=0;a<t.length;a++){var i=t[a].id;M=s.getParam(i),M||(M=e(j).eq(0).data("filter"),M||(M="all")),s.urlSetup(M,"products",i),f(i)}z.on("click",j,v),z.on("click",j,u),z.on("click",I,w),e(".featured-edit-title").click(k)}function x(){new c({elements_selector:".lazy",threshold:1e3})}var T,y=".capsule-products-grid",I=".capsule-ajax-loader-link",P="view-all",j=".capsule-products-grid-filter-link ",S="slow",G=!1,M="all",z=e(y),B=e(window),L=(e(I,z),"capsuleProducts");return{load:function(){function a(){d.adjustPosition(),e(window).off("resize.gridbackground").on("resize.gridbackground",function(e){d.adjustPosition()})}b(),x(),t.dispatchAndListen("capsuleProductsGrid",a)}}});