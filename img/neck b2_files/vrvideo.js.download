define(["jquery","eventDispatcher","os","viewport"],function(n,i,e,t){function o(i){var e=i.origin||i.originalEvent.origin;"https://www.gucciconnect.com/"===e&&"http://www.gucciconnect.com/"===e&&"https://www.gucciconnect.com"===e&&"http://www.gucciconnect.com"===e&&("iOSfullscreenON"===i.data&&Modernizr.ios&&window.screen.width<768&&n("[data-iframe-src]").parents(".video-vr").addClass("iOS-fullscreen"),"iOSfullscreenOFF"===i.data&&Modernizr.ios&&window.screen.width<768&&n("[data-iframe-src]").parents(".video-vr").removeClass("iOS-fullscreen"))}function a(n){var i={action:"onScreenOrientationChangeEvent",orientation:window.orientation||0};c(JSON.stringify(i)),n.stopPropagation()}function r(n){var i={action:"onDeviceOrientationChangeEvent",alpha:n.alpha,beta:n.beta,gamma:n.gamma};c(JSON.stringify(i)),n.stopPropagation()}function s(){function n(e){var t={action:"setDeviceMotion",alpha:e.rotationRate.alpha,beta:e.rotationRate.beta,gamma:e.rotationRate.gamma};c(JSON.stringify(t)),e.stopPropagation(),window.removeEventListener("devicemotion",n,!0),window.addEventListener("deviceorientation",i,!0)}function i(n){var e={action:"setOrientationControls",alpha:n.alpha,beta:n.beta,gamma:n.gamma};c(JSON.stringify(e)),n.stopPropagation(),e={action:"onScreenOrientationChangeEvent",orientation:window.orientation||0},c(JSON.stringify(e)),window.removeEventListener("deviceorientation",i,!0),window.addEventListener("orientationchange",a,!1),window.addEventListener("deviceorientation",r,!1),window.addEventListener("orientationchange",function(i){var e={action:"orientationchange"};c(JSON.stringify(e)),n.stopPropagation()})}window.addEventListener("devicemotion",n,!0)}function c(n){var i=window.frames.iframe;"undefined"!=typeof i&&i.postMessage(n,"*")}function d(n){var i=n,e=i.parents(".video-vr"),t=e.height();""!==i.attr("src")&&i.css("height",t+"px")}function v(){var i=n(".iframe-vr");i.each(function(){d(n(this))})}function f(i){var e=n(i),t=e.parents(".video-vr"),o=t.find(".iframe-vr"),a=t.find(".video-close"),r=t.find(".bg-video"),s=t.find(".volume"),c=n(".hero-diamond");r.length&&(r.remove(),s.remove());var v=o.attr("data-iframe-src");v+=(-1===v.indexOf("?")?"?":"&")+"lang="+n("html").attr("lang");var f=t.find(".vr-content");""===o.attr("src")&&(o.attr("src",v),setTimeout(function(){d(o)}),c.addClass("opacity0"),setTimeout(function(){f.addClass("opacity0"),a.show(),a.css("display","block"),Modernizr.ios&&window.screen.width<768&&t.addClass("iOS-fullscreen")},2e3))}function m(i){var e=n(i),t=e.parents(".video-vr"),o=t.find(".iframe-vr"),a=t.find(".vr-content"),r=n(".hero-diamond"),s={action:"onClose"};""!==o.attr("src")&&(c(JSON.stringify(s)),o.css("height","0"),a.show(),setTimeout(function(){a.removeClass("opacity0"),r.removeClass("opacity0"),e.hide()},10),setTimeout(function(){o.attr("src","")},500))}function w(i){n(i).hasClass("opacity0")&&n(i).hide()}function u(){l.remove(),h.remove()}function g(){11!=y&&e.isIE()?u():(n(window).on("resize",function(){t.debounce(v())}),p.on("click",function(n){f(n.currentTarget)}),n(".iframe-vr").on("load",function(n){s(n.currentTarget)}),E.on("click",function(i){m(i.currentTarget),n("[data-iframe-src]").parents(".video-vr").removeClass("iOS-fullscreen")}),O.on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(n){w(n.currentTarget)}),n(".hero-homepage.video-vr").on("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){setTimeout(d(n(".hero-homepage.video-vr").find(".iframe-vr")),100)}),Modernizr.ios&&(window.addEventListener?window.addEventListener("message",o,!1):window.attachEvent("onmessage",o)))}var l=n(".iframe-vr"),h=n(".play-vr-container"),p=n(".play-vr-icon"),E=n(".video-vr").find(".video-close"),O=n(".vr-content"),y=e.getIEVersion();return{load:function(){function n(){}g(),i.dispatchAndListen("vrvideo",n)}}});